<include file="Common:head"/>
<link rel="stylesheet" href="__PUBLIC__/css/page.css">
<link rel="stylesheet" href="__PUBLIC__/css/myZone.css">
<style type="text/css">

</style>
    <div class="content">
      <div class="content-top-wrap">
        <div class="content-top">
          <div class="content-left">
            <div class="user-head">
              <img src="__PUBLIC__/user_head/{$userInfo.img}" alt="">
            </div>
            
            <form id="upload" method='post' action="__URL__/up_head" enctype="multipart/form-data" class="mt20">
               <input type='file'  id="image1" name='image1' accept=".jpg,.jpeg,.png,.gif" onchange="imageUpload();">
              <!--  <input type="submit"  id="inputImage" value="上传头像(3M)"> -->
            

            <div class="user-head-wrap">
              <div class="user-head-mask">
                
              </div>
              <div class="user-head-content">
                修改头像
              </div>
            </div>
            
            </form> 

            <div class="head-explan">
              <h3>{$userInfo.nicheng|mb_substr=0,20,'utf-8'}</h3>
              <span id="userInfoSpan">{$userInfo.text}</span>
              <textarea name="userInfoTextarea" id="userInfoTextarea" >{$userInfo.text}</textarea>
              <a href="#" class="head-explan-a" id="personal-sign">编辑</a>
            </div>
            
          </div>
          
          <div class="content-right">
            <div class="user-uid">
              <span>作品</span><label>{$userInfo.video_num}</label>
              <p>UID:{$userInfo.id}</p>
            </div>
            <div class="user-friend">
              <span>粉丝</span><label for="">{$userInfo.user_friend_count}</label>
              <p>身份:{$userInfo.name_type}</p>
            </div>
            <a class="user-upvideo" href="__APP__/UpVideo" target="_blank">
              投稿
            </a>
          </div>
          
        </div>
      </div>

      <div class="content-bottom">
        <div class="directory-left">
          <ul>
            <li>
              <a class="{$lia101}" href="__APP__/MyZone?cid=101&userid={$userid}">视频</a>
            </li>
            <li>
              <a class="{$lia102}" href="__APP__/MyZone?cid=102&userid={$userid}">收藏夹</a>
            </li>
            <li>
              <a class="{$lia103}" href="__APP__/MyZone?cid=103&userid={$userid}">我关注的</a>
            </li>
            <li>
              <a class="{$lia104}" href="__APP__/MyZone?cid=104&userid={$userid}">我的粉丝</a>
            </li>
            <li>
              <a class="{$lia105}" href="__APP__/MyZone?cid=105&userid={$userid}">消息</a>
            </li>
            <li>
              <a class="{$lia106}" href="__APP__/MyZone?cid=106&userid={$userid}">账号</a>
            </li>
          </ul>
        </div>
        
        <!-- 101视频 102收藏夹 103关注 104粉丝 105消息 106账号 -->
        <switch name="{cid}">

          <case value="101">
            <!--视频-->
            <div class="directory-right">
              <div class="main-left-video main-video">
                <ul>
                    <volist name="messageList" id="v" >
                    <if condition="($key+1) % 3">
                      <li class="video-detail video-common">
                        <a class="video-img" href="__APP__/VideoDetail?vid=MAD{$v.id}" target="_blank"><img src="__PUBLIC__/videos/{$v.fengmian}" alt="封面未找到" class="video_pic"></a>
                      <div class="delvideo" onclick="delVideo({$v.id},this)"></div>
                    <else/>
                      <li class="video-detail video-common-other">
                        <a class="video-img" href="__APP__/VideoDetail?vid=MAD{$v.id}" target="_blank"><img src="__PUBLIC__/videos/{$v.fengmian}" alt="封面未找到" class="video_pic"></a>
                      <div class="delvideo" style="right:0;" onclick="delVideo({$v.id},this)"></div>
                    </if>
                        
                        <a class="video-title" href="__APP__/VideoDetail?vid=MAD{$v.id}" target="_blank" class="video-distance" >
                        <h4 class="">
                          <if condition="$v.state eq 0">
                          [未审核]
                            <elseif condition="$v.state eq 2" />
                          [已被封禁]
                          </if>
                          {$v.title|mb_substr=0,18,'utf-8'}
                        </h4>
                        </a>
                        <p  class="video-distance video-distance-p">{$v.biaoqian}</p>
                        <div class="video-distance">
                          <div class="score">评分:{$v.score}</div>
                          <div class="msg">
                            <p>{$v.comments}&nbsp;评论&nbsp;/&nbsp;{$v.collect}&nbsp;收藏</p>
                          </div>
            
                          <a href="__URL__/edit_video?video_id=MAD{$v.id}" target="_blank" class="head-explan-avideo head-explan-common">编辑</a>
                        </div>
                      </li>
                  </volist>
            
                </ul>
                
              </div>
            
              <div class="manu" >     
                <if condition="$messageList neq null">       
                  {$page}
                <else />
                </if>
              </div>
            </div>
          </case>

          <case value="102">
            <!--收藏夹-->
            <div class="directory-right">
       
             <div class="main-left-video main-video">
               <ul>
                   <volist name="messageList" id="v" >
                   <if condition="($key+1) % 3">
                     <li class="video-detail video-common">
                     <a class="video-img" href="__APP__/VideoDetail?vid=MAD{$v.video_id}" target="_blank"><img src="__PUBLIC__/videos/{$v.fengmian}" alt="封面未找到" class="video_pic"></a>
                      <div class="delvideo" onclick="delSc({$v.id},this)"></div>

                     <else/>
                     <li class="video-detail video-common-other">
                     <a class="video-img" href="__APP__/VideoDetail?vid=MAD{$v.video_id}" target="_blank"><img src="__PUBLIC__/videos/{$v.fengmian}" alt="封面未找到" class="video_pic"></a>
                      <div class="delvideo" style="right:0;" onclick="delSc({$v.id},this)"></div>
                   </if>
                       
                       <a class="video-title" href="__APP__/VideoDetail?vid=MAD{$v.video_id}" target="_blank" class="video-distance" ><h4 class="">{$v.title}</h4></a>
                       <p  class="video-distance video-distance-p">{$v.biaoqian}</p>
                       <div class="video-distance">
                         <div class="score">评分:{$v.score}</div>
                         <div class="msg">
                           <p>{$v.comments}&nbsp;评论&nbsp;/&nbsp;{$v.collect}&nbsp;收藏</p>
                         </div>
                        
                         <a href="#" class="copy head-explan-common video-distance-b" value="{$_SERVER['SERVER_NAME']}__APP__/VideoDetail?vid=MAD{$v.video_id}">复制链接</a>
                       </div>
                     </li>
                 </volist>
               </ul>
               
             </div>
           
             <div class="manu" >     
               <if condition="$messageList neq null">       
                 {$page}
               <else />
               </if>
             </div>
           </div>
          </case>

          <case value="103">
            <!--关注-->
            <div class="directory-right" style="padding:50px 0 0 50px; width:794px;">
            
              <div class="main-left-video main-video">
                <ul>
                  <volist id="fans" name="messageList">
                    <li class="main-video-li video-common-aa">
                      <div class="user-friend-a">
                        <div class="user-head">
                          <img src="__PUBLIC__/user_head/{$fans.img}" alt="">
                        </div>

                        <div class="head-explan-div">
                          <h3>{$fans.nicheng|mb_substr=0,20,'utf-8'}</h3>
                          <a href="#" class="head-explan-aa">私信</a>
                          <a href="#" class="head-explan-bb" value="{$fans.uid}" >删除</a>
                          
                        </div>
                      </div>
                    </li>
                  </volist>
                    
            
                </ul>
                
              </div>
            
              <div class="manu" >     
                <if condition="$messageList neq null">       
                  {$page}
                <else />
                </if>
              </div>
            </div>
          </case>

          <case value="104">
            <!--粉丝-->

            <div class="directory-right" style="padding:50px 0 0 50px; width:794px;">
            
              <div class="main-left-video main-video">
                <ul>
                  <volist id="fans" name="messageList">

                    <li class="main-video-li video-common-aa">
                      <div class="user-friend-a">
                        <div class="user-head">
                          <img src="__PUBLIC__/user_head/{$fans.img}" alt="">
                        </div>
                        <div class="head-explan-div">
                          
                          <h3>{$fans.nicheng|mb_substr=0,20,'utf-8'}</h3>
                          <a href="#" class="head-explan-dd">私信</a>
                          <if condition="$fans.is_mutual eq 0">
                            <a href="#" class="head-explan-cc" name="addgz">关注</a>
                          <else/>
                            <a href="#" class="head-explan-cc" style="color:#999" name="addgz">已关注</a>
                          </if>
                          <input type="hidden" name="user_friend_id" value="{$fans.uid}">
                        </div>
                      </div>
                    </li>
                  </volist>
                </ul>
                
              </div>
            
              <div class="manu" >     
                <if condition="$messageList neq null">       
                  {$page}
                <else />
                </if>
              </div>
            </div>
          </case>

          <case value="105">
             <!--消息-->
             <input type="hidden" value="{$listRows}" id="listRows">
             <div class="directory-right" style="padding:50px 50px 0 50px; width:744px; ">
             
             <div class="video-comment-title">
               <ul>
                 <li class="{$reply}" data-tab="reply">回复我</li>
                 <li class="{$msg}" data-tab="msg">私信</li>
                 <li class="{$notice}" data-tab="notice">通知</li>
               </ul>
             </div>

             <div class="video-comment-list video-comment-{$reply}" data-tab="reply" data-tabVal="1">

                <!-- <div class="comment">
                 <div class="comment-left">
                   <img src="__PUBLIC__/images/userhead.jpg" alt="">
                 </div>
                 <div class="comment-right">
                   <ul>
                     <li class="comment-title">
                       <div>
                         <span class="comment-title-num">#1243</span><span class="comment-title-name">雨泪飘零</span>
                       </div>
                       
                     </li>
                     <li class="comment-content">
                       倒闭神真是吊
                     </li>
                     <li class="comment-date">
                       <div>2015-04-05 15:23</div>
                     </li>
                   </ul>
                          
                   <div class="comment-control">
                     <a href="" class="comment-control-del">回复</a><a href="" class="comment-control-return">跳转</a>
                   </div>
                 </div>
                </div>  -->

             </div>
              
              <div class="video-comment-list video-comment-{$msg}" data-tab="msg" data-tabVal="2">

                <!-- <div class="comment">
                 <div class="comment-left">
                   <img src="__PUBLIC__/images/userhead.jpg" alt="">
                 </div>
                 <div class="comment-right">
                   <ul>
                     <li class="comment-title">
                       <div>
                         <span class="comment-title-num">#1243</span><span class="comment-title-name">雨泪飘零</span>
                       </div>
                       
                     </li>
                     <li class="comment-content">
                       倒闭神真是吊
                     </li>
                     <li class="comment-date">
                       <div>2015-04-05 15:23</div>
                     </li>
                   </ul>
                          
                   <div class="comment-control">
                     <a href="" class="comment-control-del">回复</a><a href="" class="comment-control-return">跳转</a>
                   </div>
                 </div>
                </div>  -->

             </div>

             <div class="video-comment-list video-comment-{$notice}" data-tab="notice" data-tabVal="3">
                
              <foreach name="messageList" item="notice">
                <div class="comment">
                   
                   <div class="comment-right comment-right-notice">
                     <ul >
                       <li class="comment-title">
                         <div>

                           <span class="comment-title-num">系统通知</span>
                          <if condition="$notice.state eq 0">
                          <span class="comment-title-name">(new)</span>
                             <else/>
                          </if>

                         </div>
                         
                       </li>
                       <li class="comment-content">
                         {$notice.message}
                       </li>
                       <li class="comment-date">
                         <div>{$notice.notice_date}</div>
                       </li>
                     </ul>
                            
                     <div class="comment-control"><a data-id="{$notice.id}" class="comment-control-return">删除</a>
                     </div>
                   </div>
                 </div>

              </foreach>

                <div class="manu notice-page" >     
                 <if condition="$messageList neq null">       
                   {$page}
                 <else />
                 </if>
                </div>

             </div>
                            
               
             </div> 
          </case>

          <case value="106">
            <!--账号-->
            <div class="directory-right" style="padding:50px 0 0 50px; width:794px;">
            
              <div class="main-account main-video">
                <ul class="main-account-ul">
                    <li>邮箱：{$userInfo.email}</li>
                    <li>昵称：{$userInfo.nicheng}</li>
                    <li>注册时间：{$userInfo.reg_time|date='Y-m-d', ###}</li>
                    
                   <div class="main-split-img">修改密码</div>
                </ul>
                
                <form action="__URL__/updatePwd" method="POST">
                <div class="main-detail">
                  <div class="main-input">
                    <h3>旧密码:</h3>
                    <input class="input-normal" type="password" id="oldpassword" name="oldpassword" onkeyup="checkUser(this.value,this.name)">
                    <label for="oldpassword"></label>
                  </div>

                  <div class="main-input">
                    <h3>新密码:</h3>
                    <input class="input-normal" type="password" id="password" name="password" onkeyup="checkUser(this.value,this.name)" >
                    <label for="password"></label>
                  </div>

                  <div class="main-input">
                    <h3>确认新密码:</h3>
                    <input class="input-normal" type="password" id="rpassword" name="rpassword" onkeyup="checkUser(this.value,this.name)" >
                    <label for="rpassword"></label>
                  </div>
                  
                  <input class="input-normal" type="submit" >
                </div>
                </form>
              </div>
            
                <script type='text/javascript'>
                  var xml;
                  function checkUser(myValue,name){

                    var url="http://"+ window.location.host+"/Regist/check?"+name+"="+myValue;
                    spanname = name;
                    xml=new XMLHttpRequest();
                    xml.onreadystatechange=state_Change;
                    xml.open('post',url,true);
                    xml.send();
                  }
                  function state_Change()
                  {
                    if (xml.readyState==4)
                    {
                      if (xml.status==200)
                      {
                        $('#'+spanname).next('label').text(xml.responseText);
                      }
                      else
                      {
                        //alert("Problem retrieving data:" + xml.statusText);
                      }
                    }
                  }
                </script>

            </div> 
          </case>

          <default />

        </switch>

      </div>
    </div>

<include file="Common:foot"/>
<script type="text/javascript" src="__PUBLIC__/jQuery-zclip/jquery.zclip.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/ajax_MyZone_all.js"></script>
<script type="text/javascript">

$(document).ready(function(){

/* 定义所有class为copy标签，点击后可复制被点击对象的文本 */
    $(".copy").zclip({
        path: "__PUBLIC__/jQuery-zclip/ZeroClipboard.swf",
        copy: function(){
          return $(this).attr('value');
        },
        beforeCopy:function(){/* 按住鼠标时的操作 */
            //$(this).css("color","orange");
        },
        afterCopy:function(){/* 复制成功后的操作 */
            var $copysuc = $("<div class='copy-tips'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");
            $("body").find(".copy-tips").remove().end().append($copysuc);
            $(".copy-tips").fadeOut(3000);
        }
    });
/* 定义所有class为copy-input标签，点击后可复制class为input的文本 */
    $(".copy-input").zclip({
        path: "__PUBLIC__/jQuery-zclip/ZeroClipboard.swf",
        copy: function(){
          return $(this).parent().find(".input").val();
        },
        afterCopy:function(){/* 复制成功后的操作 */
            var $copysuc = $("<div class='copy-tips'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");
            $("body").find(".copy-tips").remove().end().append($copysuc);
            $(".copy-tips").fadeOut(3000);
        }
    });

    $('.video-comment-title li').bind('click', function(){
      if(!$(this).hasClass('activity')){

        $('.video-comment-title li.activity').removeClass('activity');
        $('.video-comment-activity').removeClass('video-comment-activity');

        var thiss = $(this);
        $('.video-comment-list').each(function(index, value){
          if(thiss.data('tab') == $(value).data('tab')){
            thiss.addClass('activity');
            $(value).addClass('video-comment-activity');

            refresh($(value).data('tabval'));
          }

        });


      }
    });

    refresh($('.video-comment-activity').data('tabval'));
    function refresh(tabVal){
      
      var thiss = $(this);
      var ntValue = $('.manu>.current').text();
      var pageLimit = $("#listRows").val();
      
      var url ="http://"+ window.location.host;

      $.post(url+"/index.php/MyZone/refreshNotice",{ntValue:ntValue,tabVal:tabVal,pageLimit:pageLimit},function(res){
        alert(res.data);
        
      },"json");
    }

    $('.comment-control-return').bind('click', function(){

      var id = $(this).data('id');
      var thiss = $(this);
      var url ="http://"+ window.location.host;
      $.post(url+"/index.php/MyZone/delNotice",{id:id},function(res){
        if(res.status == 0){
          alert(res.data);
        }else if(res.status == 1){
          alert(res.data);
          thiss.parent().parent().parent().remove();

        }
        
      },"json");

    })

    userShow();
});

function userShow(){

    $('.content-left .user-head').bind('mouseover', function(){
      $('.content-left .user-head-wrap').css('display','block');
    });
    $('.content-left .user-head').bind('mouseout', function(){
      $('.content-left .user-head-wrap').css('display','none');

    });

    $('.content-left .user-head-wrap').bind('mouseover', function(){
      $('.content-left .user-head-wrap').css('display','block');
    });
    $('.content-left .user-head-wrap').bind('mouseout', function(){
      $('.content-left .user-head-wrap').css('display','none');

    });

    $('.content-left .user-head-wrap').bind('click', function(){
      $('#image1').click();

    })

}

function imageUpload(){
  $('#upload').submit();
}

/*$('input[type="file"]').attr('name');
$('input[type="file"]').val();*/
</script>